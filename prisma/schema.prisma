generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                  String                @id @default(cuid())
  name                String?
  email               String               @unique
  password            String?
  emailVerified       DateTime?
  role                UserRole              @default(user)
  image               String?
  createdAt           DateTime              @default(now())
  updatedAt           DateTime              @updatedAt
  isActive            Boolean               @default(true)
  lastLogin           DateTime?
  phone               String?
  isAdmin             Boolean               @default(false)
  accounts            Account[]
  documentLogs        DocumentLog[]
  permohonanAhliWaris PermohonanAhliWaris[]
  profile             Profile?
  sessions            Session[]
  suratPernyataan     SuratPernyataan[]
}

model Account {
  id                String  @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?
  user              User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}

model PermohonanAhliWaris {
  id                    String           @id @default(cuid())
  userId                String?
  email                 String
  nomorTelepon          String?
  namaPemohon           String
  nikPemohon            String
  alamatPemohon         String
  hubunganDenganPewaris String
  namaPewaris           String
  nikPewaris            String
  alamatPewaris         String
  tanggalMeninggal      DateTime
  statusPernikahan      String
  daftarAhliWaris       Json
  createdAt             DateTime         @default(now())
  statusPermohonan      StatusPermohonan @default(PENDING)
  agamaPewaris          String?
  catatanAdmin          String?
  instansiNikah         String?
  noSuratNikah          String?
  nomorAkteKematian     String?
  pekerjaanPewaris      String?
  suratPernyataanId     String?          @unique
  tanggalAkteKematian   DateTime?
  tanggalLahirPewaris   DateTime?
  tanggalNikah          DateTime?
  tempatLahirPewaris    String?
  updatedAt             DateTime         @updatedAt
  suratPernyataan       SuratPernyataan? @relation(fields: [suratPernyataanId], references: [id])
  user                  User?            @relation(fields: [userId], references: [id])

  @@index([statusPermohonan])
  @@index([userId])
  @@index([createdAt])
}

model Profile {
  id           String    @id @default(cuid())
  userId       String    @unique
  alamat       String?
  nomorTelepon String?
  tanggalLahir DateTime?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  agama        String?
  nik          String?
  pekerjaan    String?
  user         User      @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model SuratPernyataan {
  id                   String               @id @default(cuid())
  nomorSurat           String               @unique
  tanggalSurat         DateTime             @default(now())
  namaPewaris          String
  namaAyahPewaris      String
  tempatLahirPewaris   String
  tanggalLahirPewaris  DateTime
  alamatPewaris        String
  rtPewaris            String?
  rwPewaris            String?
  kelurahanPewaris     String               @default("Grogol")
  kecamatanPewaris     String               @default("Grogol Petamburan")
  kotaPewaris          String               @default("Jakarta Barat")
  tempatMeninggal      String?
  tanggalMeninggal     DateTime?
  noAkteKematian       String?
  tanggalAkteKematian  DateTime?
  instansiAkteKematian String?              @default("Dinas Dukcapil Provinsi DKI Jakarta")
  statusPernikahan     String
  noSuratNikah         String?
  tanggalNikah         DateTime?
  instansiNikah        String?
  ahliWaris            Json
  dataPewaris          Json
  jumlahAnak           Int                  @default(0)
  jumlahIstri          Int                  @default(0)
  jumlahSaudara        Int                  @default(0)
  jumlahCucu           Int                  @default(0)
  kondisi              String
  status               StatusSurat          @default(DRAFT)
  catatan              String?
  isGenerated          Boolean              @default(false)
  generatedAt          DateTime?
  downloadCount        Int                  @default(0)
  pdfFileName          String?
  pdfFileSize          Int?
  reviewNotes         String?
  reviewedBy          String?
  reviewedAt          DateTime?
  printCount          Int                  @default(0)
  lastPrinted         DateTime?
  pdfUrl               String?
  pdfStoragePath      String?
  pdfMimeType         String?
  pdfChecksum         String?
  pdfVersion          Int                  @default(0)
  pdfGeneratedBy      String?
  pdfLastGenerated     DateTime?
  userId               String
  createdAt            DateTime             @default(now())
  updatedAt            DateTime             @updatedAt
  agamaPewaris         String?
  pekerjaanPewaris     String?
  documentLogs         DocumentLog[]
  permohonan           PermohonanAhliWaris?
  user                 User                 @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([nomorSurat])
  @@index([userId])
  @@index([status])
  @@index([createdAt])
}

model DocumentLog {
  id                String          @id @default(cuid())
  suratPernyataanId String
  userId            String?
  action            DocumentAction
  details           String?
  ipAddress         String?
  userAgent         String?
  metadata          Json?
  createdAt         DateTime        @default(now())
  suratPernyataan   SuratPernyataan @relation(fields: [suratPernyataanId], references: [id], onDelete: Cascade)
  user              User?           @relation(fields: [userId], references: [id])

  @@index([suratPernyataanId])
  @@index([action])
  @@index([createdAt])
}

model playing_with_neon {
  id    Int    @id @default(autoincrement())
  name  String
  value Float? @db.Real
}

enum UserRole {
  user
  admin
  super_admin
}

enum StatusPermohonan {
  PENDING
  IN_REVIEW
  APPROVED
  REJECTED
  COMPLETED
}

enum StatusSurat {
  DRAFT
  SUBMITTED
  VERIFIED
  APPROVED
  REJECTED
  ARCHIVED
}

enum DocumentAction {
  CREATE
  UPDATE
  DOWNLOAD
  VIEW
  PRINT
  GENERATE_PDF
  DELETE
  STATUS_CHANGE
}
